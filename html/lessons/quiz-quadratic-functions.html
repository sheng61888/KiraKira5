<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz ¬∑ Quadratic Functions</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/learner.css">
</head>

<body>
  <div class="app quiz-app">
    <aside class="sidebar">
      <div class="logo"><img src="/images/logo transparent.png" alt="KiraKira logo"></div>
      <nav class="nav">
        <a href="../learner-home.html">Dashboard</a>
        <a href="../learner-progress.html">Progress</a>
        <a href="../learner-pastyears.html">Past Papers</a>
        <a href="../learner-classes.html">Classes</a>
        <a href="../learner-community.html">Community</a>
        <a href="../learner-profile.html">Profile</a>
      </nav>
    </aside>

    <main class="main quiz-main">
      <header class="page-heading">
        <p class="eyebrow">Mini-Quiz ¬∑ Quadratic Functions</p>
        <h1>How well can you read a parabola?</h1>
      </header>

      <section class="card quiz-block" id="quiz">
        <!-- Dynamic question injected by JS -->
      </section>
    </main>
  </div>

<script src="../../js/learner-session.js"></script>
<script src="../../js/learner-activity.js"></script>
<script>
  const quizData = [
    {
      question: "If a > 0, the parabola opens ____.",
      options: ["Upward", "Downward", "Sideways"],
      correct: 0,
      explanation: "When a > 0, the curve smiles ‚Äî it opens upward."
    },
    {
      question: "For y = -2x¬≤ + 3x - 1, what kind of turning point does it have?",
      options: ["Minimum point", "Maximum point"],
      correct: 1,
      explanation: "Negative a means the curve frowns; it has a maximum."
    },
    {
      question: "The vertex represents:",
      options: ["The midpoint between roots", "The highest or lowest point", "The point where y = 0"],
      correct: 1,
      explanation: "It‚Äôs the turning point where direction changes."
    },
    {
      question: "Increasing |a| makes the parabola:",
      options: ["Narrower", "Wider", "Shift left"],
      correct: 0,
      explanation: "Larger |a| means a steeper, more dramatic curve."
    },
    {
      question: "If a parabola only touches the x-axis once, what does it mean?",
      options: ["No real roots", "One repeated root", "Crosses twice"],
      correct: 1,
      explanation: "Touching once means a repeated (equal) root at the vertex."
    }
  ];

  let current = 0;
  let score = 0;
  const quizStartedAt = Date.now();
  const quizContainer = document.getElementById("quiz");

  function renderQuestion() {
    const q = quizData[current];
    quizContainer.innerHTML = `
      <div class="quiz-progress">Question ${current + 1} of ${quizData.length}</div>
      <h2>${q.question}</h2>
      <div class="quiz-options">
        ${q.options.map(
          (opt, i) => `<button class="quiz-option" data-index="${i}">${opt}</button>`
        ).join("")}
      </div>
      <p class="quiz-feedback"></p>
    `;
    document.querySelectorAll(".quiz-option").forEach(btn =>
      btn.addEventListener("click", handleAnswer)
    );
  }

  function handleAnswer(e) {
    const index = parseInt(e.target.dataset.index);
    const q = quizData[current];
    const feedback = document.querySelector(".quiz-feedback");
    const buttons = document.querySelectorAll(".quiz-option");

    buttons.forEach(b => b.disabled = true);
    e.target.classList.add(index === q.correct ? "correct" : "wrong");

    if (index === q.correct) score++;

    feedback.textContent = index === q.correct
      ? "‚úÖ " + q.explanation
      : "‚ùå " + q.explanation;

    const nextBtn = document.createElement("button");
    nextBtn.className = "btn btn--primary quiz-next";
    nextBtn.textContent = current < quizData.length - 1 ? "Next" : "Finish";
    nextBtn.addEventListener("click", nextQuestion);
    feedback.after(nextBtn);
  }

  function nextQuestion() {
    current++;
    if (current < quizData.length) {
      renderQuestion();
    } else {
      renderResults();
    }
  }

  function renderResults() {
    const total = quizData.length;
    const percent = Math.round((score / total) * 100);
    let message, sub;

    if (percent === 100) {
      message = "üèÜ Perfect!";
      sub = "Unstoppable! You read parabolas like poetry ‚Äî flawless performance.";
    } else if (percent >= 60) {
      message = "‚ú® Great job!";
      sub = "You‚Äôre getting the hang of it. A few more practice swings and you‚Äôll master every vertex and root.";
    } else {
      message = "üå± Keep going!";
      sub = "Not bad ‚Äî every mathematician starts somewhere. Revisit the lessons, then come back stronger.";
    }

    quizContainer.innerHTML = `
      <h2>${message}</h2>
      <p>You got <strong>${score}</strong> out of <strong>${total}</strong> correct (${percent}%).</p>
      <p>${sub}</p>
      <div class="wrap-actions">
        <a href="quiz-quadratic-functions.html" class="btn btn--ghost">Try again</a>
        <a href="../course-map.html?module=form4-01" class="btn btn--primary">Back to module map</a>
      </div>
    `;

    if (window.kiraActivity && typeof window.kiraActivity.logModuleQuiz === "function") {
      window.kiraActivity.logModuleQuiz({
        moduleId: "form4-01",
        unitId: "quiz-vertex-sense",
        scorePercent: percent,
        durationSeconds: Math.max(1, Math.round((Date.now() - quizStartedAt) / 1000))
      });
    }
    if (window.kiraActivity && typeof window.kiraActivity.logModuleProgress === "function") {
      window.kiraActivity.logModuleProgress({
        moduleId: "form4-01",
        unitId: "quiz-vertex-sense",
        status: "completed",
        scorePercent: percent,
        durationSeconds: Math.max(1, Math.round((Date.now() - quizStartedAt) / 1000))
      });
    }
  }

  renderQuestion();
</script>

</body>
</html>
